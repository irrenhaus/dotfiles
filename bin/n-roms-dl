#!/bin/zsh

NAMES=()
SECTIONS=()

usage() {
    echo "Usage:   n-roms-dl <ROM name> <section id>"
    echo "Example: n-roms-dl \"Zelda 4 (D)\" snes"
    exit 1
}

if [ -e "$1" ]; then
    # First param was a file. Read the rom names from the file
    while read line; do
        data=("${(s/:/)line}")
        NAMES+=( $data[1] )
        SECTIONS+=( $data[2] )
    done < "$1"
else
    NAMES=("$1")
    SECTIONS=("$2")
fi

C=1
for NAME in $NAMES; do
    SECTION=$SECTIONS[$C]
    echo "Downloading $NAME in section $SECTION"
    let C++

    if [[ -z "$NAME" ]] || [[ -z "$SECTION" ]]; then
        usage
    fi

    SAFE_NAME=$(echo "$NAME" | tr "[() ]" "_")

    mkdir -p "$SECTION/$SAFE_NAME"

    (cd "$SECTION/$SAFE_NAME" && date > log.txt && wget "http://www.n-roms.de/roms/$SECTION/$NAME.zip" -O rom.zip >> log.txt && unzip rom.zip >> log.txt && rm rom.zip)
done
